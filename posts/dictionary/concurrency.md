---
title: 동시성 문제 해결과 병렬성
pubDate: 2024-08-09

tags: [thread]
category: CS
---

# 동시성 문제 해결

## 상황 만들기

베타 사용자를 대상으로 문의가 들어와서 확인해보니 게시판에서 등록 버튼을 빠르게 두번 눌렀더니 동일한 제목을 가진 두개의 게시물 등록 되었다는 것이었다.

> 특정 언어 및 프레임워크 사용법보다는 이론적인 설명에 가깝습니다.

흔히 다음과 같은 문제가 발생했을 때는 스프링에서 `@Transactional`를 붙이고 데이터베이스 락을 사용하는 것은 누구나 외우는 것만으로도 충분히 할 수 있다. 하지만 이런 문제를 해결하는 과정에서 동시성을 모른다면 "건드리니까 해결 되긴하더라" 식으로 해결은 할 수 있겠지만 **왜** 이런 문제가 발생했고, 자세한 작동 원리가 무엇인지는 알 수 없다.

## 동시성이란 무엇일까?

동시성이란 Task들을 동시에 처리할 수 있는 것 처럼 보이지만 Context Switch를 통해 여러 Task를 번갈아가면서 실행해서 동시에 처리할 수 있는 것처럼 보이는 것이다.

![동시성 예시](/posts/concurrency.png)

## 맨 처음 상황의 원인

위의 예시 상황에서의 게시물 등록 서비스는 동일한 제목이 있는지 확인하고 없다면 저장하는 간단한 짜임을 가지고 있다. 2번 타임라인을 보면 첫번째 요청은 동일한 제목이 없는 것이 확인되었지만 저장된 것은 아니기 때문에 두번째 요청도 실행이 된다. 하지만 두 요청 모두 문제없이 저장을 하면서 동일한 제목의 게시물이 두개나 생겨버렸다.

![동시성 예시](/posts/concurrency-timeline.png)

## 데이터베이스 락으로 해결하기

동일한 제목이 있는지 확인하는 과정에서는 데이터베이스에 접근하게 된다. 이때 데이터베이스에 동시에 접근할 수 없게 한다면 제목을 확인하는 요청이 동시에 이루어지지 않게 되어 문제가 생기지 않는다.

![데이터베이스 락 타임라인](/posts/lock-timeline.png)

# 동시성과 병렬성의 차이

병렬성과 동시성은 같은 개념이라고 착각하기 쉽지만 동시성은 위에서도 설명했지만 동시에 실행되는 것처럼 보이지만 Task가 번갈아가면서 작업이 점차 실행되는 것이고, 병렬성은 물리적으로 같은 시간에 여러 Task가 동시에 실행되는 것이다.

![동시성과 병렬성](/posts/difference.png)
